{
  "feature_title": "Implementación del sistema de registro de logs desde sistemas externos",
  "tasks": [
    {
      "id": "T01",
      "title": "Arquitectar y crear DTO de request para registro de logs",
      "description": "Crear `LogRegisterRequestDto` con validaciones Bean Validation según especificación: campos `mensaje` (String, requerido, máximo 5000 caracteres), `nivel` (enum ERROR|WARN|INFO|DEBUG, requerido), `stackTrace` (String, opcional) y `metadata` (String JSON serializado, opcional). El DTO debe seguir el patrón del proyecto usando Lombok y validaciones con mensajes de `ValidationMessages`.",
      "command": "/generate",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/logs/dtos/LogRegisterRequestDto.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "El archivo `src/main/java/trinity/play2learn/backend/configs/logs/dtos/LogRegisterRequestDto.java` existe y contiene todos los campos especificados.",
        "El DTO incluye validaciones `@NotNull`, `@NotBlank`, `@Size`, y enum `LogLevel` con valores ERROR, WARN, INFO, DEBUG.",
        "El DTO usa anotaciones Lombok (`@Data`, `@AllArgsConstructor`, `@NoArgsConstructor`, `@Builder`) siguiendo el patrón del proyecto."
      ]
    },
    {
      "id": "T02",
      "title": "Refinar DTO de registro de logs",
      "description": "Refinar `LogRegisterRequestDto` agregando docstrings, validaciones mejoradas y asegurando compliance con estilo del proyecto.",
      "command": "/refine",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/logs/dtos/LogRegisterRequestDto.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "El DTO incluye documentación JavaDoc completa para cada campo.",
        "Las validaciones usan mensajes de `ValidationMessages` cuando corresponda.",
        "El código cumple con estándares de estilo del proyecto sin warnings de linting."
      ]
    },
    {
      "id": "T03",
      "title": "Configurar soporte asíncrono en Spring (@Async)",
      "description": "Crear `AsyncConfig` para habilitar procesamiento asíncrono con `@EnableAsync` y configurar `ThreadPoolTaskExecutor` con pool de threads dedicado para operaciones no bloqueantes (corePoolSize=5, maxPoolSize=10, queueCapacity=100). La configuración debe ser thread-safe y permitir operaciones fire-and-forget.",
      "command": "/generate",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/async/AsyncConfig.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "El archivo `src/main/java/trinity/play2learn/backend/configs/async/AsyncConfig.java` existe con `@EnableAsync` y configuración de `ThreadPoolTaskExecutor`.",
        "El executor tiene configuración apropiada para operaciones asíncronas no bloqueantes.",
        "El bean `taskExecutor` está configurado correctamente para Spring."
      ]
    },
    {
      "id": "T04",
      "title": "Refinar configuración asíncrona",
      "description": "Mejorar `AsyncConfig` agregando documentación, configuraciones adicionales de logging y manejo de excepciones no capturadas en tareas asíncronas.",
      "command": "/refine",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/async/AsyncConfig.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "La configuración incluye JavaDoc explicando propósito y uso.",
        "Se configura `RejectedExecutionHandler` apropiado para manejar overflow del pool.",
        "El código cumple con estándares de estilo sin warnings."
      ]
    },
    {
      "id": "T05",
      "title": "Crear servicio cliente de logs asíncrono",
      "description": "Implementar `LogsClientService` que registra logs de forma asíncrona (fire-and-forget) usando `@Async`. El servicio debe: inyectar `LOGS_API_BASE_URL` y `LOGS_API_PRIVATE_KEY` mediante `@Value`, usar `RestTemplate` configurado con timeout de 5 segundos, enviar POST a `{LOGS_API_BASE_URL}/logs` con headers `Content-Type: application/json` y `X-Application-Key: {LOGS_API_PRIVATE_KEY}`, manejar errores silenciosamente sin afectar flujo principal, validar configuración y truncar mensajes a 5000 caracteres. El método principal debe ser `registerLog(String mensaje, LogLevel nivel, String stackTrace, Map<String, Object> metadata)`.",
      "command": "/generate",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/logs/services/LogsClientService.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "El archivo `src/main/java/trinity/play2learn/backend/configs/logs/services/LogsClientService.java` existe e implementa registro asíncrono.",
        "El servicio usa `@Async` para operaciones no bloqueantes y `RestTemplate` con timeout configurado.",
        "El servicio valida configuración, maneja errores silenciosamente y no lanza excepciones que afecten el flujo principal.",
        "El método `registerLog` acepta parámetros según especificación y serializa metadata a JSON string cuando corresponde."
      ]
    },
    {
      "id": "T06",
      "title": "Refinar servicio cliente de logs",
      "description": "Mejorar `LogsClientService` agregando docstrings completos, mejor manejo de errores con logging apropiado, configuración de `RestTemplate` como bean si es necesario, y validaciones adicionales.",
      "command": "/refine",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/logs/services/LogsClientService.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "El servicio incluye JavaDoc completo explicando comportamiento asíncrono y fire-and-forget.",
        "El logging de errores es apropiado para troubleshooting sin afectar rendimiento.",
        "El código cumple con estándares de estilo y mejores prácticas de Spring."
      ]
    },
    {
      "id": "T07",
      "title": "Configurar variables de entorno en application.properties",
      "description": "Agregar referencias a variables de entorno `LOGS_API_BASE_URL` y `LOGS_API_PRIVATE_KEY` en `application.properties` para que Spring las inyecte mediante `@Value`. Las variables deben leerse desde `.env` mediante `DotenvConfig` existente.",
      "command": "/generate",
      "params": {
        "target_file": "src/main/resources/application.properties"
      },
      "status": "done",
      "acceptance_criteria": [
        "El archivo `application.properties` incluye líneas `logs.api.base.url=${LOGS_API_BASE_URL}` y `logs.api.private.key=${LOGS_API_PRIVATE_KEY}`.",
        "Las propiedades están documentadas con comentarios explicando su propósito.",
        "La configuración es consistente con el patrón existente del proyecto."
      ]
    },
    {
      "id": "T08",
      "title": "Crear enum LogLevel para niveles de log",
      "description": "Crear enum `LogLevel` con valores `ERROR`, `WARN`, `INFO`, `DEBUG` para tipado fuerte en el DTO y servicio de logs. El enum debe incluir métodos utilitarios si es necesario.",
      "command": "/generate",
      "params": {
        "target_file": "src/main/java/trinity/play2learn/backend/configs/logs/models/LogLevel.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "El archivo `src/main/java/trinity/play2learn/backend/configs/logs/models/LogLevel.java` existe con valores ERROR, WARN, INFO, DEBUG.",
        "El enum está documentado y sigue convenciones del proyecto.",
        "El enum puede ser usado directamente en `LogRegisterRequestDto` y `LogsClientService`."
      ]
    },
    {
      "id": "T09",
      "title": "Escribir pruebas unitarias para LogsClientService",
      "description": "Crear suite de pruebas `LogsClientServiceTest` cubriendo: registro exitoso de log, manejo silencioso de errores de red/timeout, validación de configuración faltante, truncamiento de mensajes a 5000 caracteres, serialización correcta de metadata a JSON, verificación de headers HTTP correctos (Content-Type y X-Application-Key), verificación de que el método es asíncrono y no bloquea, manejo de diferentes niveles de log.",
      "command": "/generate",
      "params": {
        "target_file": "src/test/java/trinity/play2learn/backend/configs/logs/services/LogsClientServiceTest.java"
      },
      "status": "done",
      "acceptance_criteria": [
        "La suite `LogsClientServiceTest` existe y cubre todos los escenarios críticos mencionados.",
        "Los tests usan `@Nested`, `@DisplayName` con patrón Given-When-Then y mocks apropiados de `RestTemplate`.",
        "Los tests verifican comportamiento asíncrono y no bloqueante del servicio.",
        "Todos los tests pasan exitosamente con cobertura ≥ 85%."
      ]
    },
    {
      "id": "T10",
      "title": "Escribir pruebas unitarias para LogRegisterRequestDto",
      "description": "Crear suite de pruebas `LogRegisterRequestDtoTest` cubriendo: construcción con valores válidos, validaciones Bean Validation (mensaje null/blank/excede 5000, nivel null/inválido, stackTrace y metadata opcionales), serialización a JSON correcta, deserialización desde JSON.",
      "command": "/generate",
      "params": {
        "target_file": "src/test/java/trinity/play2learn/backend/configs/logs/dtos/LogRegisterRequestDtoTest.java"
      },
      "status": "todo",
      "acceptance_criteria": [
        "La suite `LogRegisterRequestDtoTest` existe y cubre validaciones y serialización.",
        "Los tests usan `jakarta.validation.Validator` para validar anotaciones.",
        "Los tests verifican construcción, serialización y deserialización correcta.",
        "Todos los tests pasan exitosamente."
      ]
    },
    {
      "id": "T11",
      "title": "Refinar pruebas unitarias",
      "description": "Revisar y mejorar suites de pruebas agregando helpers reutilizables si es necesario, mejorando legibilidad, y asegurando cobertura completa sin duplicar código.",
      "command": "/refine",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/configs/logs"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Los tests usan fixtures compartidos y helpers reutilizables donde corresponde.",
        "Cada escenario documenta explícitamente el motivo de la validación esperada.",
        "La cobertura incluye casos límite sin duplicar código.",
        "Todos los tests mantienen patrón Given-When-Then con documentación clara."
      ]
    },
    {
      "id": "T12",
      "title": "Ejecutar pruebas y verificar cobertura",
      "description": "Ejecutar todas las suites de pruebas del módulo de logs con JaCoCo para verificar que todos los tests pasan y la cobertura cumple con los criterios establecidos.",
      "command": "/test",
      "params": {
        "command": "./mvnw.cmd org.jacoco:jacoco-maven-plugin:prepare-agent test org.jacoco:jacoco-maven-plugin:report -Dtest=trinity.play2learn.backend.configs.logs.**"
      },
      "status": "done",
      "acceptance_criteria": [
        "El comando finaliza sin errores y produce `target/site/jacoco/index.html` actualizado.",
        "Cobertura de servicios alcanza ≥ 85% en líneas y ≥ 75% en ramas.",
        "Todas las suites de pruebas pasan exitosamente (0 fallos, 0 errores)."
      ]
    }
  ]
}
