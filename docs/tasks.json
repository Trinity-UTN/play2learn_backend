{
  "feature_title": "Plan de pruebas unitarias para módulo Benefits",
  "tasks": [
    {
      "id": "T01",
      "title": "Auditar servicios, controladores y DTOs del módulo Benefits",
      "description": "Inventariar clases, responsabilidades, validaciones y dependencias de services, controllers y DTOs del módulo `benefits`, excluyendo models, repositories, mappers y specs.",
      "command": "/analyze",
      "params": {
        "targets": [
          "src/main/java/trinity/play2learn/backend/benefits"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Se documenta en `docs/testing/benefits-unit-tests-audit.md` el inventario completo de artefactos relevantes.",
        "Quedan registradas validaciones clave, excepciones y dependencias externas por cada componente.",
        "Se listan riesgos de negocio sin cobertura de pruebas actual."
      ]
    },
    {
      "id": "T02",
      "title": "Diseñar estrategia de pruebas unitarias para Benefits",
      "description": "Definir alcance, métricas de cobertura, dobles de prueba y fixtures compartidos para services, controllers y DTOs del módulo `benefits` siguiendo restricciones del contexto.",
      "command": "/design",
      "params": {
        "artifact": "docs/testing/benefits-unit-test-strategy.md"
      },
      "status": "done",
      "acceptance_criteria": [
        "El documento establece objetivos de cobertura y criterios de salida por tipo de componente.",
        "Incluye matriz de escenarios priorizados por riesgo y dependencias simuladas.",
        "Detalla datos de prueba reutilizables y lineamientos para fixtures comunes."
      ]
    },
    {
      "id": "T03",
      "title": "Generar pruebas para services principales de Benefits",
      "description": "Crear suites unitarias para `BenefitGenerateService`, `BenefitDeleteService`, `BenefitPurchaseService`, `BenefitListByTeacherService`, `BenefitListByTeacherPaginatedService`, `BenefitListByStudentPaginatedService`, `BenefitStudentCountService`, `BenefitRequestUseService`, `BenefitAcceptUseService`, `BenefitListPurchasesService`, `BenefitListPurchasesPaginatedService`, `BenefitListUseRequestedService`, `BenefitListUseRequestedPaginatedService`, `BenefitListUsedByStudentService` y `BenefitListUsedByStudentPaginatedService`.",
      "command": "/generate",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitGenerateServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitDeleteServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitPurchaseServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListByTeacherServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListByTeacherPaginatedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListByStudentPaginatedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitStudentCountServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitRequestUseServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitAcceptUseServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListPurchasesServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListPurchasesPaginatedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListUseRequestedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListUseRequestedPaginatedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListUsedByStudentServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/BenefitListUsedByStudentPaginatedServiceTest.java"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Se cubren escenarios de éxito y excepciones relevantes (`NotFoundException`, `ConflictException`, `UnauthorizedException`) para cada servicio.",
        "Mocks verifican interacciones con servicios commons, repositorios y mappers simulados.",
        "Asserts validan DTOs resultantes y mensajes de excepción esperados con AssertJ."
      ]
    },
    {
      "id": "T04",
      "title": "Refinar pruebas de services principales de Benefits",
      "description": "Optimizar suites de services principales eliminando duplicidades, mejorando legibilidad y reutilización de datos mediante fixtures compartidos.",
      "command": "/refine",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/services"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Helpers/builder centralizados generan requests, entidades y DTOs simulados consistentes.",
        "Cada caso usa `@DisplayName` y asserts AssertJ descriptivos con patrón Given-When-Then.",
        "Se mantiene cobertura de ramas sin warnings de Mockito ni code smells."
      ]
    },
    {
      "id": "T05",
      "title": "Generar pruebas para services commons de Benefits",
      "description": "Crear suites unitarias para services commons: `BenefitGetByIdService`, `BenefitGetByStudentService`, `BenefitGetStudentStateService`, `BenefitGetPurchasesLeftByStudentService`, `BenefitGetLastPurchaseService`, `BenefitIsPurchasedService`, `BenefitIsUseRequestedService`, `BenefitPurchaseGetByIdService`, `BenefitValidatePurchaseLimitService`, `BenefitValidateIfPurchasedByStudentService`, `BenefitFilterByStudentStateService` y `BenefitCreateStudentDtosService`.",
      "command": "/generate",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitGetByIdServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitGetByStudentServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitGetStudentStateServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitGetPurchasesLeftByStudentServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitGetLastPurchaseServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitIsPurchasedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitIsUseRequestedServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitPurchaseGetByIdServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitValidatePurchaseLimitServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitValidateIfPurchasedByStudentServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitFilterByStudentStateServiceTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/services/commons/BenefitCreateStudentDtosServiceTest.java"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Se cubren escenarios de éxito y excepciones (`NotFoundException`) para cada servicio común.",
        "Mocks verifican interacciones con repositorios y servicios externos simulados.",
        "Asserts validan respuestas booleanas, listas y objetos resultantes con AssertJ."
      ]
    },
    {
      "id": "T06",
      "title": "Refinar pruebas de services commons de Benefits",
      "description": "Optimizar suites de services commons eliminando duplicidades, mejorando legibilidad y reutilización de datos mediante fixtures compartidos.",
      "command": "/refine",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/services/commons"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Helpers/builder centralizados generan entidades y objetos de prueba consistentes.",
        "Cada caso usa `@DisplayName` y asserts AssertJ descriptivos con patrón Given-When-Then.",
        "Se mantiene cobertura de ramas sin warnings de Mockito ni code smells."
      ]
    },
    {
      "id": "T07",
      "title": "Generar pruebas para controllers de Benefits",
      "description": "Crear pruebas `@WebMvcTest`/`MockMvc` para `BenefitGenerateController`, `BenefitDeleteController`, `BenefitListController`, `BenefitListPaginatedController`, `BenefitListByStudentPaginatedController`, `BenefitPurchaseController`, `BenefitStudentCountController`, `BenefitRequestUseController`, `BenefitAcceptUseController`, `BenefitListPurchasesController`, `BenefitListPurchasesPaginatedController`, `BenefitListUseRequestedByTeacherController`, `BenefitListUseRequestedPaginatedController`, `BenefitListUsedByStudentController` y `BenefitListUsedPaginatedController`.",
      "command": "/generate",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitGenerateControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitDeleteControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListPaginatedControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListByStudentPaginatedControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitPurchaseControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitStudentCountControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitRequestUseControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitAcceptUseControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListPurchasesControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListPurchasesPaginatedControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListUseRequestedByTeacherControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListUseRequestedPaginatedControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListUsedByStudentControllerTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/controllers/BenefitListUsedPaginatedControllerTest.java"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Se cubren respuestas exitosas (200/201/204) y errores relevantes (400/401/404/409).",
        "Validación de payloads JSON mediante `jsonPath` y serialización esperada.",
        "Mocks confirman delegación a servicios correspondientes y validación de roles con `@SessionRequired`."
      ]
    },
    {
      "id": "T08",
      "title": "Refinar pruebas de controllers de Benefits",
      "description": "Pulir suite de controladores centralizando configuración MockMvc y expresando claramente cada caso.",
      "command": "/refine",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/controllers"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Configuración de MockMvc/ObjectMapper centralizada en `@BeforeEach` con helpers reutilizables.",
        "Casos documentados con `@DisplayName` y comentarios breves del flujo validado.",
        "Requests/responses JSON construidos mediante métodos utilitarios sin duplicidad."
      ]
    },
    {
      "id": "T09",
      "title": "Generar pruebas de validación para DTOs de Benefits",
      "description": "Agregar pruebas de Bean Validation para DTOs: `BenefitRequestDto`, `BenefitPurchaseRequestDto`, cubriendo mensajes y combinaciones límite.",
      "command": "/generate",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/dtos/BenefitDtoValidationTest.java",
          "src/test/java/trinity/play2learn/backend/benefits/dtos/BenefitPurchaseDtoValidationTest.java"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Se verifican anotaciones `@NotNull`, `@NotBlank`, `@Size`, `@Min`, `@Future`, `@Valid` según corresponda.",
        "Escenarios válidos generan conjunto vacío de `ConstraintViolation`.",
        "Mensajes de error coinciden con `ValidationMessages` del módulo."
      ]
    },
    {
      "id": "T10",
      "title": "Refinar pruebas de DTOs de Benefits",
      "description": "Revisar la suite de validación para mejorar reutilización de fixtures y cobertura de combinaciones límite.",
      "command": "/refine",
      "params": {
        "targets": [
          "src/test/java/trinity/play2learn/backend/benefits/dtos"
        ]
      },
      "status": "done",
      "acceptance_criteria": [
        "Builders/helpers generan DTOs válidos e inválidos reutilizables en todos los casos.",
        "Cada escenario documenta explícitamente el motivo de la violación esperada.",
        "Cobertura incluye campos opcionales/nulos sin duplicar código."
      ]
    },
    {
      "id": "T11",
      "title": "Preparar suites del módulo Benefits para ejecución con JaCoCo",
      "description": "Ejecutar todas las suites unitarias del módulo `benefits` preparando el agente JaCoCo y generando reporte de cobertura.",
      "command": "/test",
      "params": {
        "command": "./mvnw.cmd org.jacoco:jacoco-maven-plugin:prepare-agent test org.jacoco:jacoco-maven-plugin:report"
      },
      "status": "done",
      "acceptance_criteria": [
        "El comando finaliza sin errores y produce `target/site/jacoco/index.html` actualizado.",
        "Cobertura de services/controllers/DTOs alcanza ≥ 85 % en líneas y ≥ 75 % en ramas.",
        "Incidencias o fallas detectadas quedan registradas para seguimiento inmediato."
      ]
    },
    {
      "id": "T12",
      "title": "Consolidar reporte automatizado de pruebas para Benefits",
      "description": "Generar documentación consolidada de las pruebas del módulo ejecutando el script estándar con el módulo `benefits`.",
      "command": "/report",
      "params": {
        "command": "python scripts/testing_report.py --module \"benefits\" --output \"docs/testing/test_benefits.md\""
      },
      "status": "done",
      "acceptance_criteria": [
        "El archivo `docs/testing/test_benefits.md` resume métricas y hallazgos actualizados.",
        "El reporte contiene cobertura JaCoCo, suites ejecutadas y riesgos remanentes.",
        "Se incluyen siguientes pasos o pendientes identificados durante la ejecución."
      ]
    }
  ]
}